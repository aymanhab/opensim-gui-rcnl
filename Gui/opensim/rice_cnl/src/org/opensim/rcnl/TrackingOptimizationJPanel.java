/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package org.opensim.rcnl;

import java.awt.Dialog;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Observable;
import java.util.Observer;
import java.util.Vector;
import javax.swing.ListSelectionModel;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import org.openide.DialogDescriptor;
import org.openide.DialogDisplayer;
import org.openide.util.Exceptions;
import org.opensim.modeling.AbstractProperty;
import org.opensim.modeling.Model;
import org.opensim.modeling.OpenSimObject;
import org.opensim.modeling.PropertyObjectList;
import org.opensim.utils.FileUtils;
import org.opensim.view.pub.OpenSimDB;

/**
 *
 * @author Ayman-NMBL
 */
public class TrackingOptimizationJPanel extends BaseToolPanel  implements Observer {
    private JointPersonalizationToolModel jointPersonalizationToolModel = null;
    private JMPTaskListModel jointPersonalizationTaskListModel = null;
    private ListSelectionModel listSelectionModel;
    
    /**
     * Creates new form JointPersonalizationJPanel
     */
    public TrackingOptimizationJPanel(Model model)  throws IOException  {
       if(model==null) throw new IOException("JointPersonalizationJPanel got null model");
       jointPersonalizationToolModel = new JointPersonalizationToolModel(model);
       jointPersonalizationTaskListModel = new JMPTaskListModel(jointPersonalizationToolModel.getJointTaskListAsObjectList());
       initComponents();
       jJointPersonalizationList.setModel(jointPersonalizationTaskListModel);
       listSelectionModel = jJointPersonalizationList.getSelectionModel();
       listSelectionModel.addListSelectionListener(
                            new ListSelectionHandler());
       currentModelFileTextField.setText(model.getInputFileName());
       outputModelFilePath.setCheckIfFileExists(false);
       outputModelFilePath.setFileName(jointPersonalizationToolModel.getOutputModelFile());
       setSettingsFileDescription("Save Joint Personalization Settings file (xml)");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        inputModelPanel = new javax.swing.JPanel();
        jLabel13 = new javax.swing.JLabel();
        currentModelFileTextField = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        osimxFilePath = new org.opensim.swingui.FileTextFieldAndChooser();
        InitialGuessDirPath = new org.opensim.swingui.FileTextFieldAndChooser();
        jLabel4 = new javax.swing.JLabel();
        InitialGuessDirPath1 = new org.opensim.swingui.FileTextFieldAndChooser();
        jLabel6 = new javax.swing.JLabel();
        outputPanel = new javax.swing.JPanel();
        outputDirPath = new org.opensim.swingui.FileTextFieldAndChooser();
        jLabel5 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        solverSettingsFilePath = new org.opensim.swingui.FileTextFieldAndChooser();
        jCoordinatesListPanel = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jCoordinateListTextArea = new javax.swing.JTextArea();
        jButtonEditCoordinateList = new javax.swing.JButton();
        jCostTermListPanel = new javax.swing.JPanel();
        jButtonEditCostTermList = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        jCoordinateListTextArea1 = new javax.swing.JTextArea();
        jConstraintTermListPanel = new javax.swing.JPanel();
        jButtonEditConstraintTermList = new javax.swing.JButton();
        jScrollPane3 = new javax.swing.JScrollPane();
        jConstraintListTextArea = new javax.swing.JTextArea();
        jTorqueControllerPanel = new javax.swing.JPanel();
        jCheckBoxTorqueController = new javax.swing.JCheckBox();
        jEditTorqueControllerButton = new javax.swing.JButton();
        jSynergyControllerPanel = new javax.swing.JPanel();
        jCheckBoxSynergyController = new javax.swing.JCheckBox();
        jEditSynergyControllerButton = new javax.swing.JButton();

        inputModelPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.inputModelPanel.border.title"))); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jLabel13, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jLabel13.text")); // NOI18N

        currentModelFileTextField.setEditable(false);
        currentModelFileTextField.setToolTipText(org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.currentModelFileTextField.toolTipText")); // NOI18N
        currentModelFileTextField.setMinimumSize(new java.awt.Dimension(3, 20));

        org.openide.awt.Mnemonics.setLocalizedText(jLabel3, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jLabel3.text")); // NOI18N

        osimxFilePath.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                osimxFilePathStateChanged(evt);
            }
        });

        InitialGuessDirPath.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                InitialGuessDirPathStateChanged(evt);
            }
        });

        org.openide.awt.Mnemonics.setLocalizedText(jLabel4, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jLabel4.text")); // NOI18N

        InitialGuessDirPath1.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                InitialGuessDirPath1StateChanged(evt);
            }
        });

        org.openide.awt.Mnemonics.setLocalizedText(jLabel6, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jLabel6.text")); // NOI18N

        javax.swing.GroupLayout inputModelPanelLayout = new javax.swing.GroupLayout(inputModelPanel);
        inputModelPanel.setLayout(inputModelPanelLayout);
        inputModelPanelLayout.setHorizontalGroup(
            inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(inputModelPanelLayout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addGroup(inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3)
                    .addComponent(jLabel4)
                    .addComponent(jLabel13)
                    .addComponent(jLabel6))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(currentModelFileTextField, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(InitialGuessDirPath, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(inputModelPanelLayout.createSequentialGroup()
                        .addComponent(osimxFilePath, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGap(3, 3, 3))
                    .addComponent(InitialGuessDirPath1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        inputModelPanelLayout.setVerticalGroup(
            inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(inputModelPanelLayout.createSequentialGroup()
                .addGroup(inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(currentModelFileTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3)
                    .addComponent(osimxFilePath, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 12, Short.MAX_VALUE)
                .addGroup(inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(InitialGuessDirPath, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel4))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 12, Short.MAX_VALUE)
                .addGroup(inputModelPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(InitialGuessDirPath1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6))
                .addGap(16, 16, 16))
        );

        outputPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder(), org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.outputPanel.border.title"))); // NOI18N

        outputDirPath.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                outputDirPathStateChanged(evt);
            }
        });

        org.openide.awt.Mnemonics.setLocalizedText(jLabel5, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jLabel5.text")); // NOI18N

        javax.swing.GroupLayout outputPanelLayout = new javax.swing.GroupLayout(outputPanel);
        outputPanel.setLayout(outputPanelLayout);
        outputPanelLayout.setHorizontalGroup(
            outputPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
            .addGroup(outputPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(outputPanelLayout.createSequentialGroup()
                    .addGap(13, 13, 13)
                    .addComponent(jLabel5)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(outputDirPath, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGap(13, 13, 13)))
        );
        outputPanelLayout.setVerticalGroup(
            outputPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 69, Short.MAX_VALUE)
            .addGroup(outputPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(outputPanelLayout.createSequentialGroup()
                    .addContainerGap()
                    .addGroup(outputPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(outputDirPath, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel5))
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jPanel2.border.title"))); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jLabel7, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jLabel7.text")); // NOI18N

        solverSettingsFilePath.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                solverSettingsFilePathStateChanged(evt);
            }
        });

        jCoordinatesListPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jCoordinatesListPanel.border.title"))); // NOI18N

        jCoordinateListTextArea.setEditable(false);
        jCoordinateListTextArea.setBackground(new java.awt.Color(240, 240, 240));
        jCoordinateListTextArea.setColumns(20);
        jCoordinateListTextArea.setRows(5);
        jCoordinateListTextArea.setEnabled(false);
        jCoordinateListTextArea.setFocusable(false);
        jScrollPane1.setViewportView(jCoordinateListTextArea);

        org.openide.awt.Mnemonics.setLocalizedText(jButtonEditCoordinateList, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jButtonEditCoordinateList.text")); // NOI18N
        jButtonEditCoordinateList.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonEditCoordinateListActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jCoordinatesListPanelLayout = new javax.swing.GroupLayout(jCoordinatesListPanel);
        jCoordinatesListPanel.setLayout(jCoordinatesListPanelLayout);
        jCoordinatesListPanelLayout.setHorizontalGroup(
            jCoordinatesListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jCoordinatesListPanelLayout.createSequentialGroup()
                .addComponent(jScrollPane1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jButtonEditCoordinateList, javax.swing.GroupLayout.PREFERRED_SIZE, 220, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jCoordinatesListPanelLayout.setVerticalGroup(
            jCoordinatesListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jCoordinatesListPanelLayout.createSequentialGroup()
                .addGroup(jCoordinatesListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 156, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jCoordinatesListPanelLayout.createSequentialGroup()
                        .addGap(37, 37, 37)
                        .addComponent(jButtonEditCoordinateList)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jCostTermListPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jCostTermListPanel.border.title"))); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jButtonEditCostTermList, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jButtonEditCostTermList.text")); // NOI18N
        jButtonEditCostTermList.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonEditCostTermListActionPerformed(evt);
            }
        });

        jCoordinateListTextArea1.setEditable(false);
        jCoordinateListTextArea1.setBackground(new java.awt.Color(240, 240, 240));
        jCoordinateListTextArea1.setColumns(20);
        jCoordinateListTextArea1.setRows(5);
        jCoordinateListTextArea1.setEnabled(false);
        jCoordinateListTextArea1.setFocusable(false);
        jScrollPane2.setViewportView(jCoordinateListTextArea1);

        javax.swing.GroupLayout jCostTermListPanelLayout = new javax.swing.GroupLayout(jCostTermListPanel);
        jCostTermListPanel.setLayout(jCostTermListPanelLayout);
        jCostTermListPanelLayout.setHorizontalGroup(
            jCostTermListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jCostTermListPanelLayout.createSequentialGroup()
                .addComponent(jScrollPane2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButtonEditCostTermList, javax.swing.GroupLayout.PREFERRED_SIZE, 231, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        jCostTermListPanelLayout.setVerticalGroup(
            jCostTermListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jCostTermListPanelLayout.createSequentialGroup()
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 114, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 34, Short.MAX_VALUE))
            .addGroup(jCostTermListPanelLayout.createSequentialGroup()
                .addGap(35, 35, 35)
                .addComponent(jButtonEditCostTermList)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jConstraintTermListPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jConstraintTermListPanel.border.title"))); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jButtonEditConstraintTermList, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jButtonEditConstraintTermList.text")); // NOI18N
        jButtonEditConstraintTermList.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonEditConstraintTermListActionPerformed(evt);
            }
        });

        jConstraintListTextArea.setEditable(false);
        jConstraintListTextArea.setBackground(new java.awt.Color(240, 240, 240));
        jConstraintListTextArea.setColumns(20);
        jConstraintListTextArea.setRows(5);
        jConstraintListTextArea.setEnabled(false);
        jConstraintListTextArea.setFocusable(false);
        jScrollPane3.setViewportView(jConstraintListTextArea);

        javax.swing.GroupLayout jConstraintTermListPanelLayout = new javax.swing.GroupLayout(jConstraintTermListPanel);
        jConstraintTermListPanel.setLayout(jConstraintTermListPanelLayout);
        jConstraintTermListPanelLayout.setHorizontalGroup(
            jConstraintTermListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jConstraintTermListPanelLayout.createSequentialGroup()
                .addComponent(jScrollPane3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButtonEditConstraintTermList, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        jConstraintTermListPanelLayout.setVerticalGroup(
            jConstraintTermListPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jConstraintTermListPanelLayout.createSequentialGroup()
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(jConstraintTermListPanelLayout.createSequentialGroup()
                .addGap(36, 36, 36)
                .addComponent(jButtonEditConstraintTermList)
                .addContainerGap(63, Short.MAX_VALUE))
        );

        org.openide.awt.Mnemonics.setLocalizedText(jCheckBoxTorqueController, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jCheckBoxTorqueController.text")); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jEditTorqueControllerButton, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jEditTorqueControllerButton.text")); // NOI18N

        javax.swing.GroupLayout jTorqueControllerPanelLayout = new javax.swing.GroupLayout(jTorqueControllerPanel);
        jTorqueControllerPanel.setLayout(jTorqueControllerPanelLayout);
        jTorqueControllerPanelLayout.setHorizontalGroup(
            jTorqueControllerPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jTorqueControllerPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jCheckBoxTorqueController)
                .addGap(58, 58, 58)
                .addComponent(jEditTorqueControllerButton, javax.swing.GroupLayout.PREFERRED_SIZE, 169, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jTorqueControllerPanelLayout.setVerticalGroup(
            jTorqueControllerPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jTorqueControllerPanelLayout.createSequentialGroup()
                .addContainerGap(19, Short.MAX_VALUE)
                .addGroup(jTorqueControllerPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jCheckBoxTorqueController)
                    .addComponent(jEditTorqueControllerButton))
                .addGap(16, 16, 16))
        );

        org.openide.awt.Mnemonics.setLocalizedText(jCheckBoxSynergyController, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jCheckBoxSynergyController.text")); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jEditSynergyControllerButton, org.openide.util.NbBundle.getMessage(TrackingOptimizationJPanel.class, "TrackingOptimizationJPanel.jEditSynergyControllerButton.text")); // NOI18N

        javax.swing.GroupLayout jSynergyControllerPanelLayout = new javax.swing.GroupLayout(jSynergyControllerPanel);
        jSynergyControllerPanel.setLayout(jSynergyControllerPanelLayout);
        jSynergyControllerPanelLayout.setHorizontalGroup(
            jSynergyControllerPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jSynergyControllerPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jCheckBoxSynergyController)
                .addGap(47, 47, 47)
                .addComponent(jEditSynergyControllerButton)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jSynergyControllerPanelLayout.setVerticalGroup(
            jSynergyControllerPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jSynergyControllerPanelLayout.createSequentialGroup()
                .addContainerGap(19, Short.MAX_VALUE)
                .addGroup(jSynergyControllerPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jCheckBoxSynergyController)
                    .addComponent(jEditSynergyControllerButton))
                .addGap(16, 16, 16))
        );

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jSynergyControllerPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jCoordinatesListPanel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addGroup(jPanel2Layout.createSequentialGroup()
                                .addComponent(jLabel7)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(solverSettingsFilePath, javax.swing.GroupLayout.PREFERRED_SIZE, 938, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addComponent(jTorqueControllerPanel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jConstraintTermListPanel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jCostTermListPanel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addContainerGap())))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGap(38, 38, 38)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel7)
                    .addComponent(solverSettingsFilePath, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jCoordinatesListPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSynergyControllerPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jTorqueControllerPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(24, 24, 24)
                .addComponent(jCostTermListPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jConstraintTermListPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(outputPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(inputModelPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addComponent(jPanel2, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(inputModelPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(outputPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void osimxFilePathStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_osimxFilePathStateChanged
        // TODO add your handling code here:
        gcpPersonalizationToolModel.setInputOsimxFile(osimxFilePath.getFileName());
    }//GEN-LAST:event_osimxFilePathStateChanged

    private void InitialGuessDirPathStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_InitialGuessDirPathStateChanged
        // TODO add your handling code here:
        gcpPersonalizationToolModel.setDataDir(InitialGuessDirPath.getFileName());
    }//GEN-LAST:event_InitialGuessDirPathStateChanged

    private void outputDirPathStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_outputDirPathStateChanged
        // TODO add your handling code here:
    }//GEN-LAST:event_outputDirPathStateChanged

    private void InitialGuessDirPath1StateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_InitialGuessDirPath1StateChanged
        // TODO add your handling code here:
    }//GEN-LAST:event_InitialGuessDirPath1StateChanged

    private void jButtonEditCoordinateListActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonEditCoordinateListActionPerformed
        // TODO add your handling code here:
        // Create Panel for selecting from existing model coordinates
        CoordinateTableModel ctm = new CoordinateTableModel(mtpPersonalizationToolModel.getPropCoordinateListString(), model);
        SelectQuantitiesFromListJPanel selectionPanel = new SelectQuantitiesFromListJPanel(ctm);
        DialogDescriptor dlg = new DialogDescriptor(selectionPanel,"Select Coordinates");
        dlg.setModal(true);
        DialogDisplayer.getDefault().createDialog(dlg).setVisible(true);
        Object userInput = dlg.getValue();
        if (((Integer)userInput).compareTo((Integer)DialogDescriptor.OK_OPTION)==0){
            ctm.populateCoordinateListProperty();
            jCoordinateListTextArea.setText(mtpPersonalizationToolModel.getPropCoordinateListString().toString());
        }
    }//GEN-LAST:event_jButtonEditCoordinateListActionPerformed

    private void jButtonEditCostTermListActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonEditCostTermListActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButtonEditCostTermListActionPerformed

    private void solverSettingsFilePathStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_solverSettingsFilePathStateChanged
        // TODO add your handling code here:
    }//GEN-LAST:event_solverSettingsFilePathStateChanged

    private void jButtonEditConstraintTermListActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonEditConstraintTermListActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButtonEditConstraintTermListActionPerformed

    @Override
    public void update(Observable o, Object o1) {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public void pressedCancel() {
        super.pressedCancel(); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public String getToolXML() {
        return jointPersonalizationToolModel.getToolAsObject().dump();
    }

    @Override
    public void loadSettings(String nmsmFilename) {
        String fileName = super.stripOuterTags(nmsmFilename);
        Model model = OpenSimDB.getInstance().getCurrentModel();
       //if(model==null) throw new IOException("JointPersonalizationJPanel got null model");
       jointPersonalizationToolModel = new JointPersonalizationToolModel(model, fileName);
       File f= new File(fileName); 
       f.delete();
       jointPersonalizationTaskListModel = new JMPTaskListModel(jointPersonalizationToolModel.getJointTaskListAsObjectList());
       listSelectionModel = jJointPersonalizationList.getSelectionModel();
       listSelectionModel.addListSelectionListener( new ListSelectionHandler());
       //initComponents(); Panel already constructed, no need to re-initComponents
       jJointPersonalizationList.setModel(jointPersonalizationTaskListModel);
       currentModelFileTextField.setText(jointPersonalizationToolModel.getInputModelFile());
       outputModelFilePath.setFileName(jointPersonalizationToolModel.getOutputModelFile());
       setSettingsFileDescription("Save Joint Personalization Settings file (xml)");
    }

    @Override
    public void setSettingsFileDescription(String description) {
        super.setSettingsFileDescription(description); //To change body of generated methods, choose Tools | Templates.
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private org.opensim.swingui.FileTextFieldAndChooser InitialGuessDirPath;
    private org.opensim.swingui.FileTextFieldAndChooser InitialGuessDirPath1;
    private javax.swing.JTextField currentModelFileTextField;
    private javax.swing.JPanel inputModelPanel;
    private javax.swing.JButton jButtonEditConstraintTermList;
    private javax.swing.JButton jButtonEditCoordinateList;
    private javax.swing.JButton jButtonEditCostTermList;
    private javax.swing.JCheckBox jCheckBoxSynergyController;
    private javax.swing.JCheckBox jCheckBoxTorqueController;
    private javax.swing.JTextArea jConstraintListTextArea;
    private javax.swing.JPanel jConstraintTermListPanel;
    private javax.swing.JTextArea jCoordinateListTextArea;
    private javax.swing.JTextArea jCoordinateListTextArea1;
    private javax.swing.JPanel jCoordinatesListPanel;
    private javax.swing.JPanel jCostTermListPanel;
    private javax.swing.JButton jEditSynergyControllerButton;
    private javax.swing.JButton jEditTorqueControllerButton;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JPanel jSynergyControllerPanel;
    private javax.swing.JPanel jTorqueControllerPanel;
    private org.opensim.swingui.FileTextFieldAndChooser osimxFilePath;
    private org.opensim.swingui.FileTextFieldAndChooser outputDirPath;
    private javax.swing.JPanel outputPanel;
    private org.opensim.swingui.FileTextFieldAndChooser solverSettingsFilePath;
    // End of variables declaration//GEN-END:variables

    private class ListSelectionHandler implements ListSelectionListener {

        public ListSelectionHandler() {
        }

        @Override
        public void valueChanged(ListSelectionEvent lse) {
            // Disable delete if nothing is selected
            // Enable edit if single selection
            int[] sels = jJointPersonalizationList.getSelectedIndices();
            editJointTaskButton.setEnabled(sels.length==1);
            deleteJointTaskButton.setEnabled(sels.length>=1);
            
        }
    }
}
